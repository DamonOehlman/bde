#!/usr/bin/env node
var out = require('out'),
    nopt = require('nopt'),
    path = require('path'),
    knownOpts = {
        'path': [String],
        'port': [Number],
        'suffix': [String],
        'certPath': [path]
    },
    shortHands = {
        'p': ['--port'],
        's': ['--suffix']
    },
    bde = require('../'),
    opts = nopt(knownOpts, shortHands, process.argv, 2),
    _existsSync = require('fs').existsSync || path.existsSync;

// iterate through the remaining args, and attempt to assign then to locations
opts.argv.remain.forEach(function(arg) {
    // attempt to parse as an int
    var intArg = parseInt(arg, 10);

    // if the arg is a number, then assign as the port
    if (! isNaN(intArg)) {
        opts.port = intArg;
    }
    else if (_existsSync(path.resolve(arg))) {
        opts.path = path.resolve(arg);
    }
});

bde(opts, function(err, backend) {
    if (err) return out('Unable to start bde: {0}', err);

    out('!{grey}bde server started on port {0} at !{underline,grey}{1}', opts.port, opts.path);
    out('!{grey}will browserify files matching: *-{0}.js', opts.suffix);

    // if a backend has been started also, then let the user know
    if (backend) {
        out('!{grey}backend started');
    }
});